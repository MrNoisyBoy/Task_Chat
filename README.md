# üîê gRPC OTP –ß–∞—Ç-–°–∏—Å—Ç–µ–º–∞

–ö–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —Å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (OTP —á–µ—Ä–µ–∑ Google Authenticator).

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [API –ü—Ä–æ—Ç–æ–∫–æ–ª—ã](#api-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **gRPC API** - –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π RPC —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - OTP —á–µ—Ä–µ–∑ Google Authenticator
- **JWT —Ç–æ–∫–µ–Ω—ã** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **–í–µ–±—Å–æ–∫–µ—Ç-–ø–æ–¥–æ–±–Ω—ã–π —Å—Ç—Ä–∏–º–∏–Ω–≥** - —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
- **QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - —É–¥–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 2FA

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ—Ä–≤–∏—Å—ã gRPC:
1. **AuthService** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ (JWT)
2. **OtpService** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OTP (TOTP —á–µ—Ä–µ–∑ pyotp)
3. **MessagingService** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- **Python 3.8+**
- **gRPC** - —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
- **protobuf** - —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **JWT** - —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **pyotp** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ OTP
- **qrcode** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤
- **SQLite** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8 –∏–ª–∏ –≤—ã—à–µ
- pip (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤)

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone <repository-url>
cd grpc-otp-chat
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install grpcio grpcio-tools pyotp qrcode[pil] PyJWT
```

3. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ protobuf —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```bash
python -m grpc_tools.protoc -I. --python_out=. --pyi_out=. --grpc_python_out=. proto/auth.proto proto/messaging.proto proto/otp.proto
```

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
python run_server.py
```
–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `localhost:50051` –∏ —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `users.db`

### 2. –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞:
```bash
python run_client.py
```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
/register
–õ–æ–≥–∏–Ω: > your_username
–ü–∞—Ä–æ–ª—å: > your_password
```
–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø–∞–ø–∫–µ `./qr/` –ø–æ—è–≤–∏—Ç—Å—è QR-–∫–æ–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google Authenticator.

### –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:
```
/login
–õ–æ–≥–∏–Ω: > your_username
–ü–∞—Ä–æ–ª—å: > your_password
OTP –∫–æ–¥: > 123456  # –∫–æ–¥ –∏–∑ Google Authenticator
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –ø—Ä–æ—Å—Ç–æ –≤–≤–æ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–∏–º–∞–π—Ç–µ Enter. –î–ª—è –≤—ã—Ö–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ `/quit`.

## üîê API –ü—Ä–æ—Ç–æ–∫–æ–ª—ã

### 1. Auth Service (`auth.proto`)
```protobuf
service Auth {
  rpc Register(RegisterRequest) returns (RegisterResponse);
  rpc Login(LoginRequest) returns (LoginResponse);
}
```

### 2. OTP Service (`otp.proto`)
```protobuf
service Otp {
  rpc InitOtp(RequestInitOtp) returns (ResponseInitOtp);
  rpc CheckOtp(RequestCheckOtp) returns (ResponseCheckOtp);
}
```

### 3. Messaging Service (`messaging.proto`)
```protobuf
service Messaging {
  rpc MessageStream(Empty) returns (stream Message);
  rpc SendMessage(Message) returns (SendResponse);
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
grpc-otp-chat/
‚îú‚îÄ‚îÄ proto/                    # Protobuf –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ auth.proto           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ messaging.proto      # –û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ otp.proto           # OTP —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ auth_pb2*.py            # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ protobuf —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ messaging_pb2*.py
‚îú‚îÄ‚îÄ otp_pb2*.py
‚îú‚îÄ‚îÄ auth.py                 # –°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ messaging.py            # –°–µ—Ä–≤–∏—Å —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ otp.py                  # –°–µ—Ä–≤–∏—Å OTP
‚îú‚îÄ‚îÄ client.py               # gRPC –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ console.py              # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ run_server.py           # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ run_client.py           # –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ qr/                     # –ü–∞–ø–∫–∞ –¥–ª—è QR-–∫–æ–¥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ my_secret.png      # –ü—Ä–∏–º–µ—Ä QR-–∫–æ–¥–∞
‚îî‚îÄ‚îÄ users.db               # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å:
- **AuthService** - SHA256 —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π, JWT —Ç–æ–∫–µ–Ω—ã
- **OtpService** - TOTP —á–µ—Ä–µ–∑ pyotp, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤
- **MessagingService** - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π, —Å—Ç—Ä–∏–º–∏–Ω–≥

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:
- **ChatClient** - gRPC –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- **ConsoleChat** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **JWT —Å–µ–∫—Ä–µ—Ç** - –∏–∑–º–µ–Ω–∏—Ç–µ `JWT_SECRET` –≤ `auth.py` –∏ `messaging.py` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - SQLite —Ñ–∞–π–ª `users.db` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **QR-–∫–æ–¥—ã** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫—É `./qr/`
5. **–¢–æ–∫–µ–Ω—ã** - JWT —Ç–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 24 —á–∞—Å–∞

## üîç –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```
Server started on port 50051
[18:30:15] user1: –ü—Ä–∏–≤–µ—Ç!
[18:30:20] user2: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!
[18:30:25] user1: –ö–∞–∫ –¥–µ–ª–∞?
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 50051 —Å–≤–æ–±–æ–¥–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Google Authenticator –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ SHA256
- OTP —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
3. –î–æ–±–∞–≤–∏—Ç—å rate-limiting
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
